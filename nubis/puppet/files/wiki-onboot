#!/bin/bash
# Generate random secrets for Mediawiki if they don't already exist

#echo "Enabling node_exporter"
#consulate kv set "environments/$ENV/global/node_exporter/config/enabled" 1

nubis_project=$(nubis-metadata NUBIS_PROJECT)
nubis_env=$(nubis-metadata NUBIS_ENVIRONMENT)
kv_prefix="$nubis_project/$nubis_env/config"

mediawiki_secret=$(consulate kv get "$kv_prefix/SecretKey")
if [ -z "$mediawiki_secret" ]; then
    mediawiki_secret=$(openssl rand -base64 14)
    consulate kv set "$kv_prefix/SecretKey" "$mediawiki_secret"
fi

# Get a exclusive lock from consul so we only run this script once
#consul lock "$CONSUL_PREFIX/syncdb" 


def get_mediawiki_version() {
    
}
